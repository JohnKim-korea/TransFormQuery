<!DOCTYPE html>
<html xmlns:th="http//www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/queryLayout}">

<div layout:fragment="content">
 	<script type="text/javascript">
        $(document).ready(function(){
            console.log("ì£¼ì†Œ :" + window.location.href);

            document.getElementById("inputQuery").addEventListener("keydown", function(e) {
                if(e.key === "Enter") {
                    document.getElementById("convertBtn").click();
                }
            });
        });

        function transformQuery() {
            $("#outputQuery").text("").css("color","");
            const Ops = ["AND","OR","NEAR","NOT"];
            const val = $("#inputQuery").val().trim();
            if(val == null || val == ""){
                $("#outputQuery").text("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!").css("color","#ffb74d");
                return false;
            }

            for(var op of Ops){
                if(val.toLowerCase().startsWith(op.toLowerCase())){
                    $("#outputQuery").text("ë§¨ì•ìª½ì— "+op+" ì—°ì‚°ìë¥¼ ì“°ë©´ì•ˆë©ë‹ˆë‹¤.!").css("color","#ffd54f");
                    return false;
                }

                if(val.toLowerCase().endsWith(op.toLowerCase())){
                    $("#outputQuery").text("ë§¨ë’·ìª½ì— "+op+" ì—°ì‚°ìë¥¼ ì“°ë©´ì•ˆë©ë‹ˆë‹¤.!").css("color","#ffd54f");
                    return false;
                }
            }

            fetch("/study/transformQuery", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "query=" + encodeURIComponent(val)
            })
            .then(res => res.json())
            .then(data => {
                if (!data.ok) throw new Error(data.result);

                $("#outputQuery").html(
                    "ì›ë³¸ ì¿¼ë¦¬: " + val + "<br><br>" +
                    "ë³€í˜•ëœ ì¿¼ë¦¬: " + data.result
                );
                $("#inputQuery").val("");
            })
            .catch(err => {
                $("#outputQuery").text("ì˜¤ë¥˜ë©”ì„¸ì§€ => " + err.message).css("color","#ff4d4d");
            });
        }
    </script>
    <div class="container container-box">
        <h2 class="text-center app-title mb-4">ğŸ” Query Transformer</h2>
        <div class="card query-card p-4">

            <label class="label mb-2">ê²€ìƒ‰ì–´ ì…ë ¥</label>
            <div class="input-group mb-3">
                <input type="text" id="inputQuery" class="form-control" placeholder="ì—¬ê¸°ì— ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
                <button id="convertBtn" class="btn btn-primary" onclick="transformQuery();">ë³€í™˜</button>
            </div>

            <label class="label mt-2 mb-2">ë³€í˜•ëœ ì¿¼ë¦¬</label>
            <div id="outputQuery" class="result-box">ë³€í™˜ëœ ì¿¼ë¦¬ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>

        </div>
    </div>
</div>
</html>
